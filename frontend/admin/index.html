<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script>
        // Immediate redirect to login if not authenticated
        (function() {
            const isLoggedIn = sessionStorage.getItem('isAdminLoggedIn');
            if (!isLoggedIn) {
                window.location.replace('login.html');
            }
        })();
    </script>
    <script src="js/authGuard.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TechGadget</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body class="admin">
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <h2>TechGadget</h2>
                <span>Admin Panel</span>
            </div>
            <nav class="admin-nav">
                <ul>
                    <li class="active">
                        <a href="index.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="products.html">
                            <i class="fas fa-box"></i>
                            <span>Products</span>
                        </a>
                    </li>
                    <li>
                        <a href="users.html">
                            <i class="fas fa-users"></i>
                            <span>Users</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="logoutButton">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <div class="header-left">
                    <button class="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Dashboard</h1>
                    <div class="dashboard-refresh">
                        <button id="refreshDashboard" class="btn btn-sm">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <span class="last-updated">Last updated: <span id="lastUpdated">Just now</span></span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="admin-search">
                        <input type="text" placeholder="Search...">
                        <i class="fas fa-search"></i>
                    </div>
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </header>

            <div class="dashboard-content">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalRevenue">$0</h3>
                            <p>Total Revenue</p>
                        </div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> <span>8%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalUsers">0</h3>
                            <p>Total Users</p>
                        </div>
                        <div class="stat-trend up">
                            <i class="fas fa-arrow-up"></i> <span>5%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalProducts">0</h3>
                            <p>Total Products</p>
                        </div>
                        <div class="stat-trend down">
                            <i class="fas fa-arrow-down"></i> <span>2%</span>
                        </div>
                    </div>
                </div>

                <!-- Most Recent Product -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h3>Most Recent Product</h3>
                    </div>
                    <div class="card-body">
                        <div id="recentProduct">
                            <div class="loading">Loading recent product...</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="charts-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Sales Overview</h3>
                            <select id="salesPeriod" class="chart-period">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                            </select>
                        </div>
                        <canvas id="salesChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Top Products</h3>
                        </div>
                        <div id="topProducts" class="top-products-list">
                            <!-- Will be populated by JavaScript -->
                            <div class="loading">Loading top products...</div>
                        </div>
                    </div>
                </div>


                <div class="card">
                    <div class="card-icon customers">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="card-info">
                        <h3>Products</h3>
                        <h2 id="totalProducts">0</h2>
                        <p><span class="success" id="productsChange">--</span></p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-icon revenue">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="card-info">
                        <h3>Revenue</h3>
                        <p><span class="success" id="revenueChange">--</span></p>
                    </div>
                </div>
            </div>
                                </thead>
                                <tbody id="recentOrdersTableBody">
                                    <!-- Recent orders will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/main.js"></script>
    <script src="../js/theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script type="module">
        import { getProducts } from '../js/dataManager.js';

        function updateDashboard() {
            const products = getProducts();
            // In a real app, orders would come from a separate data source
            const orders = []; 

            // Calculate real data
            const totalProducts = products.length;
            const totalSales = 0; // No orders yet
            const totalOrders = orders.length;
            const totalRevenue = 0; // No orders yet
            const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;

            // Update dashboard cards with real data
            document.getElementById('totalSales').textContent = `$${totalSales.toFixed(2)}`;
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;

            // Update recent orders table
            const recentOrdersTableBody = document.getElementById('recentOrdersTableBody');
            recentOrdersTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem; color: #6b7280;">No orders yet. Orders will appear here once customers start purchasing.</td></tr>';
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
        });
    </script>
</body>
</html>
